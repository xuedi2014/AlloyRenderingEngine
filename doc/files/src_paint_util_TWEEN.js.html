<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\paint\util\TWEEN.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="72" height="72"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Bitmap.html">Bitmap</a></li>
                                <li><a href="../classes/Container.html">Container</a></li>
                                <li><a href="../classes/DisplayObject.html">DisplayObject</a></li>
                                <li><a href="../classes/Dom.html">Dom</a></li>
                                <li><a href="../classes/FPS.html">FPS</a></li>
                                <li><a href="../classes/Loader.html">Loader</a></li>
                                <li><a href="../classes/Particle.html">Particle</a></li>
                                <li><a href="../classes/ParticleSystem.html">ParticleSystem</a></li>
                                <li><a href="../classes/RAF.html">RAF</a></li>
                                <li><a href="../classes/Shape.html">Shape</a></li>
                                <li><a href="../classes/Sprite.html">Sprite</a></li>
                                <li><a href="../classes/Stage.html">Stage</a></li>
                                <li><a href="../classes/TWEEN.html">TWEEN</a></li>
                                <li><a href="../classes/Txt.html">Txt</a></li>
                                <li><a href="../classes/Vector2.html">Vector2</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\paint\util\TWEEN.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
﻿/**
* 缓动
*
* @class TWEEN
* @constructor
*/
define(&quot;ARE.TWEEN&quot;, {
    statics: {
        ctor: function () {
            if (Date.now === undefined) {

                Date.now = function () {

                    return new Date().valueOf();

                };

            }
            this._tweens = [];
        },
        REVISION: &#x27;14&#x27;,

        getAll: function () {

            return this._tweens;

        },

        removeAll: function () {

            this._tweens = [];

        },

        add: function (tween) {

            this._tweens.push(tween);

        },

        remove: function (tween) {

            var i = this._tweens.indexOf(tween);

            if (i !== -1) {

                this._tweens.splice(i, 1);

            }

        },

        update: function (time) {

            if (this._tweens.length === 0) return false;

            var i = 0;

            time = time !== undefined ? time : (typeof window !== &#x27;undefined&#x27; &amp;&amp; window.performance !== undefined &amp;&amp; window.performance.now !== undefined ? window.performance.now() : Date.now());

            while (i &lt; this._tweens.length) {

                if (this._tweens[i].update(time)) {

                    i++;

                } else {

                    this._tweens.splice(i, 1);

                }

            }

            return true;

        },

        Tween: function (object) {

            var _object = object;
            var _valuesStart = {};
            var _valuesEnd = {};
            var _valuesStartRepeat = {};
            var _duration = 1000;
            var _repeat = 0;
            var _yoyo = false;
            var _isPlaying = false;
            var _reversed = false;
            var _delayTime = 0;
            var _startTime = null;
            var _easingFunction = TWEEN.Easing.Linear.None;
            var _interpolationFunction = TWEEN.Interpolation.Linear;
            var _chainedTweens = [];
            var _onStartCallback = null;
            var _onStartCallbackFired = false;
            var _onUpdateCallback = null;
            var _onCompleteCallback = null;
            var _onStopCallback = null;

            // Set all starting values present on the target object
            for (var field in object) {

                _valuesStart[field] = parseFloat(object[field], 10);

            }

            this.to = function (properties, duration) {

                if (duration !== undefined) {

                    _duration = duration;

                }

                _valuesEnd = properties;

                return this;

            };

            this.start = function (time) {

                TWEEN.add(this);

                _isPlaying = true;

                _onStartCallbackFired = false;

                _startTime = time !== undefined ? time : (typeof window !== &#x27;undefined&#x27; &amp;&amp; window.performance !== undefined &amp;&amp; window.performance.now !== undefined ? window.performance.now() : Date.now());
                _startTime += _delayTime;

                for (var property in _valuesEnd) {

                    // check if an Array was provided as property value
                    if (_valuesEnd[property] instanceof Array) {

                        if (_valuesEnd[property].length === 0) {

                            continue;

                        }

                        // create a local copy of the Array with the start value at the front
                        _valuesEnd[property] = [_object[property]].concat(_valuesEnd[property]);

                    }

                    _valuesStart[property] = _object[property];

                    if ((_valuesStart[property] instanceof Array) === false) {
                        _valuesStart[property] *= 1.0; // Ensures we&#x27;re using numbers, not strings
                    }

                    _valuesStartRepeat[property] = _valuesStart[property] || 0;

                }

                return this;

            };

            this.stop = function () {

                if (!_isPlaying) {
                    return this;
                }

                TWEEN.remove(this);
                _isPlaying = false;

                if (_onStopCallback !== null) {

                    _onStopCallback.call(_object);

                }

                this.stopChainedTweens();
                return this;

            };

            this.stopChainedTweens = function () {

                for (var i = 0, numChainedTweens = _chainedTweens.length; i &lt; numChainedTweens; i++) {

                    _chainedTweens[i].stop();

                }

            };

            this.delay = function (amount) {

                _delayTime = amount;
                return this;

            };

            this.repeat = function (times) {

                _repeat = times;
                return this;

            };

            this.yoyo = function (yoyo) {

                _yoyo = yoyo;
                return this;

            };


            this.easing = function (easing) {

                _easingFunction = easing;
                return this;

            };

            this.interpolation = function (interpolation) {

                _interpolationFunction = interpolation;
                return this;

            };

            this.chain = function () {

                _chainedTweens = arguments;
                return this;

            };

            this.onStart = function (callback) {

                _onStartCallback = callback;
                return this;

            };

            this.onUpdate = function (callback) {

                _onUpdateCallback = callback;
                return this;

            };

            this.onComplete = function (callback) {

                _onCompleteCallback = callback;
                return this;

            };

            this.onStop = function (callback) {

                _onStopCallback = callback;
                return this;

            };

            this.update = function (time) {

                var property;

                if (time &lt; _startTime) {

                    return true;

                }

                if (_onStartCallbackFired === false) {

                    if (_onStartCallback !== null) {

                        _onStartCallback.call(_object);

                    }

                    _onStartCallbackFired = true;

                }

                var elapsed = (time - _startTime) / _duration;
                elapsed = elapsed &gt; 1 ? 1 : elapsed;

                var value = _easingFunction(elapsed);

                for (property in _valuesEnd) {

                    var start = _valuesStart[property] || 0;
                    var end = _valuesEnd[property];

                    if (end instanceof Array) {

                        _object[property] = _interpolationFunction(end, value);

                    } else {

                        // Parses relative end values with start as base (e.g.: +10, -3)
                        if (typeof (end) === &quot;string&quot;) {
                            end = start + parseFloat(end, 10);
                        }

                        // protect against non numeric properties.
                        if (typeof (end) === &quot;number&quot;) {
                            _object[property] = start + (end - start) * value;
                        }

                    }

                }

                if (_onUpdateCallback !== null) {

                    _onUpdateCallback.call(_object, value);

                }

                if (elapsed == 1) {

                    if (_repeat &gt; 0) {

                        if (isFinite(_repeat)) {
                            _repeat--;
                        }

                        // reassign starting values, restart by making startTime = now
                        for (property in _valuesStartRepeat) {

                            if (typeof (_valuesEnd[property]) === &quot;string&quot;) {
                                _valuesStartRepeat[property] = _valuesStartRepeat[property] + parseFloat(_valuesEnd[property], 10);
                            }

                            if (_yoyo) {
                                var tmp = _valuesStartRepeat[property];
                                _valuesStartRepeat[property] = _valuesEnd[property];
                                _valuesEnd[property] = tmp;
                            }

                            _valuesStart[property] = _valuesStartRepeat[property];

                        }

                        if (_yoyo) {
                            _reversed = !_reversed;
                        }

                        _startTime = time + _delayTime;

                        return true;

                    } else {

                        if (_onCompleteCallback !== null) {

                            _onCompleteCallback.call(_object);

                        }

                        for (var i = 0, numChainedTweens = _chainedTweens.length; i &lt; numChainedTweens; i++) {

                            _chainedTweens[i].start(time);

                        }

                        return false;

                    }

                }

                return true;

            };

        },
        Easing: {

            Linear: {

                None: function (k) {

                    return k;

                }

            },

            Quadratic: {

                In: function (k) {

                    return k * k;

                },

                Out: function (k) {

                    return k * (2 - k);

                },

                InOut: function (k) {

                    if ((k *= 2) &lt; 1) return 0.5 * k * k;
                    return -0.5 * (--k * (k - 2) - 1);

                }

            },

            Cubic: {

                In: function (k) {

                    return k * k * k;

                },

                Out: function (k) {

                    return --k * k * k + 1;

                },

                InOut: function (k) {

                    if ((k *= 2) &lt; 1) return 0.5 * k * k * k;
                    return 0.5 * ((k -= 2) * k * k + 2);

                }

            },

            Quartic: {

                In: function (k) {

                    return k * k * k * k;

                },

                Out: function (k) {

                    return 1 - (--k * k * k * k);

                },

                InOut: function (k) {

                    if ((k *= 2) &lt; 1) return 0.5 * k * k * k * k;
                    return -0.5 * ((k -= 2) * k * k * k - 2);

                }

            },

            Quintic: {

                In: function (k) {

                    return k * k * k * k * k;

                },

                Out: function (k) {

                    return --k * k * k * k * k + 1;

                },

                InOut: function (k) {

                    if ((k *= 2) &lt; 1) return 0.5 * k * k * k * k * k;
                    return 0.5 * ((k -= 2) * k * k * k * k + 2);

                }

            },

            Sinusoidal: {

                In: function (k) {

                    return 1 - Math.cos(k * Math.PI / 2);

                },

                Out: function (k) {

                    return Math.sin(k * Math.PI / 2);

                },

                InOut: function (k) {

                    return 0.5 * (1 - Math.cos(Math.PI * k));

                }

            },

            Exponential: {

                In: function (k) {

                    return k === 0 ? 0 : Math.pow(1024, k - 1);

                },

                Out: function (k) {

                    return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);

                },

                InOut: function (k) {

                    if (k === 0) return 0;
                    if (k === 1) return 1;
                    if ((k *= 2) &lt; 1) return 0.5 * Math.pow(1024, k - 1);
                    return 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);

                }

            },

            Circular: {

                In: function (k) {

                    return 1 - Math.sqrt(1 - k * k);

                },

                Out: function (k) {

                    return Math.sqrt(1 - (--k * k));

                },

                InOut: function (k) {

                    if ((k *= 2) &lt; 1) return -0.5 * (Math.sqrt(1 - k * k) - 1);
                    return 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);

                }

            },

            Elastic: {

                In: function (k) {

                    var s, a = 0.1, p = 0.4;
                    if (k === 0) return 0;
                    if (k === 1) return 1;
                    if (!a || a &lt; 1) { a = 1; s = p / 4; }
                    else s = p * Math.asin(1 / a) / (2 * Math.PI);
                    return -(a * Math.pow(2, 10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p));

                },

                Out: function (k) {

                    var s, a = 0.1, p = 0.4;
                    if (k === 0) return 0;
                    if (k === 1) return 1;
                    if (!a || a &lt; 1) { a = 1; s = p / 4; }
                    else s = p * Math.asin(1 / a) / (2 * Math.PI);
                    return (a * Math.pow(2, -10 * k) * Math.sin((k - s) * (2 * Math.PI) / p) + 1);

                },

                InOut: function (k) {

                    var s, a = 0.1, p = 0.4;
                    if (k === 0) return 0;
                    if (k === 1) return 1;
                    if (!a || a &lt; 1) { a = 1; s = p / 4; }
                    else s = p * Math.asin(1 / a) / (2 * Math.PI);
                    if ((k *= 2) &lt; 1) return -0.5 * (a * Math.pow(2, 10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p));
                    return a * Math.pow(2, -10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p) * 0.5 + 1;

                }

            },

            Back: {

                In: function (k) {

                    var s = 1.70158;
                    return k * k * ((s + 1) * k - s);

                },

                Out: function (k) {

                    var s = 1.70158;
                    return --k * k * ((s + 1) * k + s) + 1;

                },

                InOut: function (k) {

                    var s = 1.70158 * 1.525;
                    if ((k *= 2) &lt; 1) return 0.5 * (k * k * ((s + 1) * k - s));
                    return 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);

                }

            },

            Bounce: {

                In: function (k) {

                    return 1 - TWEEN.Easing.Bounce.Out(1 - k);

                },

                Out: function (k) {

                    if (k &lt; (1 / 2.75)) {

                        return 7.5625 * k * k;

                    } else if (k &lt; (2 / 2.75)) {

                        return 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;

                    } else if (k &lt; (2.5 / 2.75)) {

                        return 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;

                    } else {

                        return 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;

                    }

                },

                InOut: function (k) {

                    if (k &lt; 0.5) return TWEEN.Easing.Bounce.In(k * 2) * 0.5;
                    return TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;

                }

            }

        },
        Interpolation: {

            Linear: function (v, k) {

                var m = v.length - 1, f = m * k, i = Math.floor(f), fn = TWEEN.Interpolation.Utils.Linear;

                if (k &lt; 0) return fn(v[0], v[1], f);
                if (k &gt; 1) return fn(v[m], v[m - 1], m - f);

                return fn(v[i], v[i + 1 &gt; m ? m : i + 1], f - i);

            },

            Bezier: function (v, k) {

                var b = 0, n = v.length - 1, pw = Math.pow, bn = TWEEN.Interpolation.Utils.Bernstein, i;

                for (i = 0; i &lt;= n; i++) {
                    b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);
                }

                return b;

            },

            CatmullRom: function (v, k) {

                var m = v.length - 1, f = m * k, i = Math.floor(f), fn = TWEEN.Interpolation.Utils.CatmullRom;

                if (v[0] === v[m]) {

                    if (k &lt; 0) i = Math.floor(f = m * (1 + k));

                    return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);

                } else {

                    if (k &lt; 0) return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);
                    if (k &gt; 1) return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);

                    return fn(v[i ? i - 1 : 0], v[i], v[m &lt; i + 1 ? m : i + 1], v[m &lt; i + 2 ? m : i + 2], f - i);

                }

            },

            Utils: {

                Linear: function (p0, p1, t) {

                    return (p1 - p0) * t + p0;

                },

                Bernstein: function (n, i) {

                    var fc = TWEEN.Interpolation.Utils.Factorial;
                    return fc(n) / fc(i) / fc(n - i);

                },

                FactorialA:[1],
                Factorial:  function (n) {

                        var s = 1, i;
                        if (this.FactorialA[n]) return this.FactorialA[n];
                        for (i = n; i &gt; 1; i--) s *= i;
                        return this.FactorialA[n] = s;

                    

                },

                CatmullRom: function (p0, p1, p2, p3, t) {

                    var v0 = (p2 - p0) * 0.5, v1 = (p3 - p1) * 0.5, t2 = t * t, t3 = t * t2;
                    return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;

                }

            }

        }

    }
})






    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
