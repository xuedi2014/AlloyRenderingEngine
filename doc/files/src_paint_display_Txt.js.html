<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\paint\display\Txt.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="72" height="72"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Bitmap.html">Bitmap</a></li>
                                <li><a href="../classes/Container.html">Container</a></li>
                                <li><a href="../classes/DisplayObject.html">DisplayObject</a></li>
                                <li><a href="../classes/Dom.html">Dom</a></li>
                                <li><a href="../classes/FPS.html">FPS</a></li>
                                <li><a href="../classes/Loader.html">Loader</a></li>
                                <li><a href="../classes/Particle.html">Particle</a></li>
                                <li><a href="../classes/ParticleSystem.html">ParticleSystem</a></li>
                                <li><a href="../classes/RAF.html">RAF</a></li>
                                <li><a href="../classes/Shape.html">Shape</a></li>
                                <li><a href="../classes/Sprite.html">Sprite</a></li>
                                <li><a href="../classes/Stage.html">Stage</a></li>
                                <li><a href="../classes/TWEEN.html">TWEEN</a></li>
                                <li><a href="../classes/Txt.html">Txt</a></li>
                                <li><a href="../classes/Vector2.html">Vector2</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\paint\display\Txt.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
﻿//http://www.w3.org/TR/2dcontext/#dom-context-2d-filltext
//http://www.w3school.com.cn/tags/canvas_filltext.asp
/**
* 文本对象
*
* @class Txt
* @constructor
*/
define(&quot;ARE.Txt:ARE.DisplayObject&quot;, {
    ctor: function (option) {
        this._super();
        this.txt = option.txt;
        this.fontSize = option.fontSize;
        this.fontFamily = option.fontFamily;
        this.color =option. color;
        this.textAlign = &quot;center&quot;;
        this.textBaseline = &quot;top&quot;;

        this.maxWidth = option.maxWidth || 2000;

        this.square = option.square || false;
        var drawOption = this.getDrawOption({
            txt: this.txt,
            maxWidth: this.maxWidth,
            square: this.square,
            size: this.fontSize,
            alignment:  this.textAlign ,
            color: this.color||&quot;black&quot;,
            fontFamily: this.fontFamily
            //backgroundColour: document.getElementById(&#x27;backgroundColour&#x27;).value,
            //calculatedWidth: document.getElementById(&#x27;calculatedWidth&#x27;),
            //calculatedHeight: document.getElementById(&#x27;calculatedHeight&#x27;),
            //renderTo: document.getElementById(&#x27;textureCanvas&#x27;)


        });
    },
    getDrawOption: function (option) {

        var canvasX, canvasY;
        var textX, textY;
        var text = [];
        var textToWrite = option.txt;

        var maxWidth = option.maxWidth;
        var squareTexture = option.square;

        var textHeight = option.size;
        var textAlignment = option.alignment;
        var textColour = option.color;
        var fontFamily = option.fontFamily;

        var backgroundColour = option.backgroundColour;

        var canvas = document.createElement(&quot;canvas&quot;);
        var ctx = canvas.getContext(&#x27;2d&#x27;);

        ctx.font = textHeight + &quot;px &quot; + fontFamily;
        if (maxWidth &amp;&amp; this.measureText(ctx, textToWrite) &gt; maxWidth) {
            maxWidth = this.createMultilineText(ctx, textToWrite, maxWidth, text);
            canvasX = this.getPowerOfTwo(maxWidth);
        } else {
            text.push(textToWrite);
            canvasX = this.getPowerOfTwo(ctx.measureText(textToWrite).width);
        }
        canvasY = this.getPowerOfTwo(textHeight * (text.length + 1));
        if (squareTexture) {
            (canvasX &gt; canvasY) ? canvasY = canvasX : canvasX = canvasY;
        }
        option.calculatedWidth = canvasX;
        option.calculatedHeight = canvasY;

        canvas.width = canvasX;
        canvas.height = canvasY;

        switch (textAlignment) {
            case &quot;left&quot;:
                textX = 0;
                break;
            case &quot;center&quot;:
                textX = canvasX / 2;
                break;
            case &quot;right&quot;:
                textX = canvasX;
                break;
        }
        textY = canvasY / 2;

        //ctx.fillStyle = backgroundColour;
        //ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

        ctx.fillStyle = textColour;
        ctx.textAlign = textAlignment;

        ctx.textBaseline = &#x27;middle&#x27;; // top, middle, bottom
        ctx.font = textHeight + &quot;px &quot; + fontFamily;

        var offset = (canvasY - textHeight * (text.length + 1)) * 0.5;
        option.cmd = [];
        for (var i = 0; i &lt; text.length; i++) {
            if (text.length &gt; 1) {
                textY = (i + 1) * textHeight + offset;
            }

            option.cmd.push({ text: text[i], x: textX, y: textY });
            ctx.fillText(text[i], textX, textY);
        }

        this.txtCanvas = canvas;
        return option;
    },

    getPowerOfTwo: function (value, pow) {
        var pow = pow || 1;
        while (pow &lt; value) {
            pow *= 2;
        }
        return pow;
    },

    measureText: function (ctx, textToMeasure) {
        return ctx.measureText(textToMeasure).width;
    },

    createMultilineText: function (ctx, textToWrite, maxWidth, text) {
        textToWrite = textToWrite.replace(&quot;\n&quot;, &quot; &quot;);
        var currentText = textToWrite;
        var futureText;
        var subWidth = 0;
        var maxLineWidth = 0;

        var wordArray = textToWrite.split(&quot; &quot;);
        var wordsInCurrent, wordArrayLength;
        wordsInCurrent = wordArrayLength = wordArray.length;

        while (this.measureText(ctx, currentText) &gt; maxWidth &amp;&amp; wordsInCurrent &gt; 1) {
            wordsInCurrent--;
            var linebreak = false;

            currentText = futureText = &quot;&quot;;
            for (var i = 0; i &lt; wordArrayLength; i++) {
                if (i &lt; wordsInCurrent) {
                    currentText += wordArray[i];
                    if (i + 1 &lt; wordsInCurrent) { currentText += &quot; &quot;; }
                }
                else {
                    futureText += wordArray[i];
                    if (i + 1 &lt; wordArrayLength) { futureText += &quot; &quot;; }
                }
            }
        }
        text.push(currentText);
        maxLineWidth = this.measureText(ctx, currentText);

        if (futureText) {
            subWidth =this.createMultilineText(ctx, futureText, maxWidth, text);
            if (subWidth &gt; maxLineWidth) {
                maxLineWidth = subWidth;
            }
        }

        return maxLineWidth;
    },
    draw: function (ctx) {
        ctx.fillStyle = this.color;
        ctx.font = this.font;
        ctx.textAlign = this.textAlign || &quot;left&quot;;
        ctx.textBaseline = this.textBaseline || &quot;top&quot;;
        ctx.fillText(this.text, 0, 0);
    },
    clone: function () {
        var t = new Txt(this.text, this.font, this.color);
        this.cloneProps(t);
        return t;

    }

})
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
