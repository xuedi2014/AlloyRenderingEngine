<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\paint\display\Sprite.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="72" height="72"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Bitmap.html">Bitmap</a></li>
                                <li><a href="../classes/Container.html">Container</a></li>
                                <li><a href="../classes/DisplayObject.html">DisplayObject</a></li>
                                <li><a href="../classes/Dom.html">Dom</a></li>
                                <li><a href="../classes/FPS.html">FPS</a></li>
                                <li><a href="../classes/Loader.html">Loader</a></li>
                                <li><a href="../classes/Particle.html">Particle</a></li>
                                <li><a href="../classes/ParticleSystem.html">ParticleSystem</a></li>
                                <li><a href="../classes/RAF.html">RAF</a></li>
                                <li><a href="../classes/Shape.html">Shape</a></li>
                                <li><a href="../classes/Sprite.html">Sprite</a></li>
                                <li><a href="../classes/Stage.html">Stage</a></li>
                                <li><a href="../classes/TWEEN.html">TWEEN</a></li>
                                <li><a href="../classes/Txt.html">Txt</a></li>
                                <li><a href="../classes/Vector2.html">Vector2</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\paint\display\Sprite.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
﻿/**
 * 精灵，继承自DisplayObject，具体的使用例子如下：
 *
 *             var sprite = new Sprite({
 *                x: 200,
 *                y: 200,
 *                framerate: 5,
 *                imgs: [ld.get(&quot;hero&quot;), ld.get(&quot;pig&quot;)],
 *                frames: [
 *                        // x, y, width, height, imageIndex, originX, originY               
 *                        [64, 64, 64, 64],
 *                        [128, 64, 64, 64],
 *                        [192, 64, 64, 64],
 *                        [256, 64, 64, 64],
 *                        [320, 64, 64, 64],
 *                        [384, 64, 64, 64],
 *                        [448, 64, 64, 64],
 *						   [0, 192, 64, 64],
 *						   [64, 192, 64, 64],
 *                        [128, 192, 64, 64],
 *                        [192, 192, 64, 64],
 *                        [256, 192, 64, 64],
 *                        [320, 192, 64, 64],
 *                        [384, 192, 64, 64],
 *                        [448, 192, 64, 64],
 *						   [448, 192, 64, 64]
 *                ],
 *                animations: {
 *                    walk: {
 *                        frames: [0, 1, 2, 3, 4, 5, 6],
 *                        next: &quot;run&quot;,
 *                        speed: 2,
 *                        loop: false
 *                    },
 *                    happy: {
 *                        frames: [11, 12, 13, 14]
 *                    },
 *                    win: {
 *                        frames: [7, 8, 9, 10]
 *                    }
 *                },
 *                currentAnimation: &quot;walk&quot;,
 *                tickAnimationEnd: function () {
 *                    console.log(&quot;播完一轮&quot;);
 *                },
 *                animationEnd: function () {
 *                    alert(&quot;播放完成&quot;)
 *                }
 *            });
 *            stage.add(sprite);
 *
 * @class Sprite
 * @constructor
 * @param {option} option
 */
define(&quot;ARE.Sprite:ARE.DisplayObject&quot;, {
    ctor: function (option) {
        this._super();

        this.option = option;
        this.x = option.x || 0;
        this.y = option.y || 0;
        //当前frame处于整个frames的index;
        this.currentFrameIndex = 0;
        //当前frame处于该动画frames的index;
        this.animationFrameIndex = 0;
        //当前处于的动画
        this.currentAnimation = option.currentAnimation||null;
        //当前帧所处的矩形区域
        this._rect = [0, 0, 10, 10];
        //当前播放的图片
        this.img = this.option.imgs[0];
      
        //播放的时间间隔
        this.interval = 1000 / option.framerate;
        //播放的函数循环
        this.loop = null

        this.paused = false;

        this.animationEnd =option.animationEnd||null;

        if (this.currentAnimation) {
            this.gotoAndPlay(this.currentAnimation);
        }

        this.tickAnimationEnd = option.tickAnimationEnd || null;
    },
    /**
     * 继续播放（一般在暂停的时候可以调用该函数可继续）
     * @method play
     */
    play: function () {
        this.paused = false;
    },
    /**
     * 暂停播放（一般在播放的时候可以调用该函数可暂停）
     * @method stop
     */
    stop: function () {
        this.paused = true;
    },
    reset: function () {
        //当前frame处于整个frames的index;
        this.currentFrameIndex = 0;
        //当前frame处于该动画frames的index;
        this.animationFrameIndex = 0;
    },
    /**
     * 跳到某个动画并播放一定次数
     * @method gotoAndPlay
     * @param {string} animation 播放的动画名称
     * @param {num} times 播放的次数，该参数可选，不传的时候代表循环播放
     */
    gotoAndPlay: function (animation, times) {
        this.paused = false;
        this.reset();
        RAF.clearRequestInterval(this.loop);
        this.currentAnimation = animation;
      
        var self = this;
        var playTimes = 0;
        this.loop = RAF.requestInterval(function () {
      
            if (!self.paused) {
                var opt = self.option;
           
                var frames = opt.animations[self.currentAnimation].frames, len = frames.length;
  
                self.animationFrameIndex++;
                if (self.animationFrameIndex &gt; len - 1) {
                    playTimes++;
                    self.animationFrameIndex = 0;
                    if (self.tickAnimationEnd) { self.tickAnimationEnd(); }
                    if (times &amp;&amp; playTimes == times) {
                        if (self.animationEnd) self.animationEnd();
                        self.paused = true;
                        RAF.clearRequestInterval(self.loop);
                        self.parent.remove(self);
                    }
                }

                self._rect = opt.frames[frames[self.animationFrameIndex]];
                if (self._rect.length &gt; 4) self.img = opt.imgs[self._rect[4]];
            }
        }, this.interval);

    },
    /**
     * 跳到某个动画的第一帧并停止
     * @method gotoAndStop
     * @param {string} animation 播放的动画名称
     */
    gotoAndStop: function (animation) {
        this.reset();
        RAF.clearRequestInterval(this.loop);
        var self = this;
        self.currentAnimation = animation;
        var opt = self.option;
        var frames = opt.animations[self.currentAnimation].frames, len = frames.length;
        self._rect = opt.frames[frames[self.animationFrameIndex]];
        if (self._rect.length &gt; 4) self.img = opt.imgs[self._rect[4]];
    
    }


})

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
